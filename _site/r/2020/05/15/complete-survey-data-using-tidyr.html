
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Complete survey data using tidyr</title>
    <meta name="description" content="">
    <meta name="author" content="Hao Sun">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Hao Sun</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/applets">Applets</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/blog">Blog</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/coding/">Coding</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/research/">Research</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/resources/">Resources</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/courses/">Courses</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>Complete survey data using tidyr </h1>
</div>

<div class="row">
  <div class="span8">
    
<p>I prefer <a href="https://outbreaktools.ca/background/line-lists/">line lists</a> for data
recording any type of survey data. 
These line lists only recorded “cases” and therefore are missing any time the 
data are 0. 
Thus, I’m often in the scenario where I want to 
<a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a>
the data so that 0s are included.</p>

<p>Imagine the real data are</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="s2">"tidyverse"</span><span class="p">)</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tribble</span><span class="p">(</span><span class="w">
  </span><span class="o">~</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">count</span><span class="p">,</span><span class="w">
  </span><span class="m">2018</span><span class="p">,</span><span class="w"> </span><span class="m">05</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
  </span><span class="m">2018</span><span class="p">,</span><span class="w"> </span><span class="m">05</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
  </span><span class="m">2018</span><span class="p">,</span><span class="w"> </span><span class="m">06</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
  </span><span class="m">2018</span><span class="p">,</span><span class="w"> </span><span class="m">06</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
  </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="m">05</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
  </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="m">05</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> 
  </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="m">06</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
  </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="m">06</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
  </span><span class="m">2020</span><span class="p">,</span><span class="w"> </span><span class="m">05</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
  </span><span class="m">2020</span><span class="p">,</span><span class="w"> </span><span class="m">05</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
  </span><span class="m">2020</span><span class="p">,</span><span class="w"> </span><span class="m">06</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> 
  </span><span class="m">2020</span><span class="p">,</span><span class="w"> </span><span class="m">06</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
</span><span class="p">)</span><span class="w">
</span><span class="n">d</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 12 x 4
##     year month species count
##    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1  2018     5 A           0
##  2  2018     5 B           0
##  3  2018     6 A           0
##  4  2018     6 B           0
##  5  2019     5 A           1
##  6  2019     5 B           0
##  7  2019     6 A           1
##  8  2019     6 B           1
##  9  2020     5 A           1
## 10  2020     5 B           1
## 11  2020     6 A           0
## 12  2020     6 B           1</code></pre></figure>

<p>But if we record only the non-zero counts, we have the following incomplete
data.frame.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">d_incomplete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">filter</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">d_incomplete</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 6 x 4
##    year month species count
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1  2019     5 A           1
## 2  2019     6 A           1
## 3  2019     6 B           1
## 4  2020     5 A           1
## 5  2020     5 B           1
## 6  2020     6 B           1</code></pre></figure>

<p>So, we need to complete this data frame so that it looks just like the
original. 
We don’t have all the information in <code class="language-plaintext highlighter-rouge">d_incomplete</code> because we don’t even 
know that surveys were completed in 2018 or in month 5 of year 2019. 
So, we have another source of information that tells us about which surveys
occurred.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">surveys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unique</span><span class="w">
</span><span class="n">surveys</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 6 x 2
##    year month
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  2018     5
## 2  2018     6
## 3  2019     5
## 4  2019     6
## 5  2020     5
## 6  2020     6</code></pre></figure>

<p>Now, we can augment this surveys data frame with the species information
by <a href="https://stackoverflow.com/questions/11693599/alternative-to-expand-grid-for-data-frames">merging two data.frames</a></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">surveys_with_species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">surveys</span><span class="p">,</span><span class="w"> 
                             </span><span class="n">tibble</span><span class="o">::</span><span class="n">tibble</span><span class="p">(</span><span class="n">species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">d</span><span class="o">$</span><span class="n">species</span><span class="p">)),</span><span class="w"> 
                             </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">species</span><span class="p">)</span><span class="w">

</span><span class="n">surveys_with_species</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##    year month species
## 1  2018     5       A
## 2  2018     5       B
## 3  2018     6       A
## 4  2018     6       B
## 5  2019     5       A
## 6  2019     5       B
## 7  2019     6       A
## 8  2019     6       B
## 9  2020     5       A
## 10 2020     5       B
## 11 2020     6       A
## 12 2020     6       B</code></pre></figure>

<p>Finally we can 
<a href="https://dplyr.tidyverse.org/reference/join.tbl_df.html">join</a> 
the incomplete data.frame with this data.frame that contains all the surveys
and species. 
This will create NAs that we will with 0.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">right_join</span><span class="p">(</span><span class="n">d_incomplete</span><span class="p">,</span><span class="w"> 
                         </span><span class="n">surveys_with_species</span><span class="p">,</span><span class="w"> 
                         </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"year"</span><span class="p">,</span><span class="s2">"month"</span><span class="p">,</span><span class="s2">"species"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">tidyr</span><span class="o">::</span><span class="n">replace_na</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">

</span><span class="n">this</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 12 x 4
##     year month species count
##    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1  2018     5 A           0
##  2  2018     5 B           0
##  3  2018     6 A           0
##  4  2018     6 B           0
##  5  2019     5 A           1
##  6  2019     5 B           0
##  7  2019     6 A           1
##  8  2019     6 B           1
##  9  2020     5 A           1
## 10  2020     5 B           1
## 11  2020     6 A           0
## 12  2020     6 B           1</code></pre></figure>

<p>I’m not thrilled with this solution, but at least it is a solution</p>

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/news/2020/03/12/favicon-for-flatten-the-curve" title="Code to create a favicon for Flatten the Curve">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/r/2020/05/31/reading-directory-of-data-with-drake" title="Reading a directory of data with drake">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_shortname = 'jarad'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>15 May 2020</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#data management-ref">data management <span>1</span></a></li>
     
    	<li><a href="/tags.html#tidyr-ref">tidyr <span>1</span></a></li>
     
    	<li><a href="/tags.html#survey-ref">survey <span>1</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <a href="https://twitter.com/jaradniemi?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @jaradniemi</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        <p>&copy; Hao Sun 2013-2020
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="https://getbootstrap.com/2.3.2/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37794201-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

